{% extends "base.html" %} {% block content %}
<div class="card rounded shadow p-4 space-y-4">
  <h2>{{ job.title }}</h2>

  {% if job.company %}
  <p><strong>Company:</strong> {{ job.company }}</p>
  {% endif %} {% if job.location %}
  <p><strong>Location:</strong> {{ job.location }}</p>
  {% endif %}

  <div
    id="map"
    style="width: 100%; height: 300px; border-radius: 10px; margin-top: 1rem"
  ></div>

  <p><strong>Type:</strong> {{ job.get_employment_type_display }}</p>

  {% if job.min_salary or job.max_salary %}
  <p>
    <strong>Salary:</strong>
    {% if job.min_salary %}${{ job.min_salary }}{% endif %}
    <!--Placeholder-->
    {% if job.max_salary%} - ${{ job.max_salary }}{% endif %}
  </p>
  {% endif %}

  <h3>Description</h3>
  <p>{{ job.description|linebreaks }}</p>

  {% if job.requirements %}
  <h3>Requirements</h3>
  <p>{{ job.requirements|linebreaks }}</p>
  {% endif %}
</div>

{% if user.is_authenticated and user.role == 'recruiter' %}
<p>
  <a href="{% url 'jobs:my_list' %}" class="btn btn-secondary"
    >‚Üê Back to Dashboard</a
  ><a href="{% url 'jobs:delete_job' job.pk %}" class="btn btn-danger ms-2"
    >üóë Delete Job</a
  >
</p>
{% endif %} {% if user.is_authenticated and user.role == 'job_seeker' %}
<hr />
{% if applied %}
<h4 class="text-success">You have already applied for this job. Good Luck!</h4>
{% else %}
<h3>Apply for this Job</h3>
<form method="post" action="{% url 'jobs:apply_job' job.pk %}">
  {% csrf_token %}
  <textarea
    name="note"
    rows="3"
    class="form-control"
    placeholder="Add a short note (optional)"
  ></textarea>
  <button type="submit" class="btn btn-primary mt-2">Apply Now</button>
</form>
{% endif %} {% elif not user.is_authenticated %}
<p><a href="{% url 'login' %}">Log in</a> to apply for this job.</p>
{% endif %}

<script>
  function initMap() {
    const jobLocation = {
      lat: {{ job.latitude|default:"null" }},
      lng: {{ job.longitude|default:"null" }}
    };

    // If lat/lng are missing, show fallback message instead of breaking
    if (jobLocation.lat === null || jobLocation.lng === null) {
      document.getElementById("map").innerHTML =
        "<div class='alert alert-warning mt-2'>Map not available for this job (no valid coordinates).</div>";
      return;
    }

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 13,
      center: jobLocation,
    });

    new google.maps.Marker({
      position: jobLocation,
      map: map,
      title: "{{ job.title }}",
    });
  }
</script>
<script
  async
  defer
  src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap"
></script>
{% endblock %}
