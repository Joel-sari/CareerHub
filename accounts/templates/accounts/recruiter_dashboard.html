{% extends "base.html" %}
{% load static %}
{% block content %}

<!-- Wrapper -->
<div class="min-h-screen bg-white px-10 py-12">
  <div class="grid grid-cols-3 gap-20 gap-x-30 w-[95%] mx-auto items-start">

    <!-- ================= LEFT: Profile ================= -->
      <!-- Greeting -->
      <h1 class="text-3xl font-semibold text-[#243251] self-start mb-10">
        Welcome back, {{ user.username|capfirst }}
      </h1>

      <!-- Profile Info -->
      <div class="flex flex-col items-center mt-6">
        {% if user.recruiter.profile_picture %}
  <img src="{{ user.recruiter.profile_picture.url }}"
       class="w-[85px] h-[85px] rounded-full border border-gray-300 object-cover shadow-sm mb-3"
       alt="Profile Picture">
{% else %}
  <img src="{% static 'images/icon_profile.png' %}"
       class="w-[85px] h-[85px] rounded-full border border-gray-300 object-cover shadow-sm mb-3"
       alt="Default Profile">
{% endif %}
        <p class="text-lg font-semibold text-[#243251]">{{ user.username|capfirst }}</p>
        <p class="text-sm text-gray-500 mt-1">Recruiter</p>
      </div>
    </div>

    <!-- ================= MIDDLE COLUMN ================= -->

      <!-- === CARD 1: View Applicants === -->
      <div>
        <h2 class="text-2xl font-semibold text-[#243251] mb-6">View Applicants</h2>

        <div class="border border-black/30 rounded-[35px] p-6 min-h-[320px] flex flex-col justify-between shadow-sm bg-white">
          <div>
            <p class="text-xl font-medium text-[#243251] mb-5">Applicants</p>

            <!-- Small preview of recent applicants -->
            <div class="max-h-48 overflow-y-auto pr-1 space-y-1">
              {% if applications %}
                {% for app in applications|slice:":5" %}
                  <div class="grid grid-cols-3 gap-x-8 items-center py-2 border-b border-gray-100">
                    <p class="text-sm text-black">{{ app.applicant.username|capfirst }}</p>
                    <p class="text-[12px] text-gray-700 truncate">{{ app.job.title }}</p>
                    <p class="text-[13px] font-medium
                      {% if app.final_decision == 'hired' %}text-green-600
                      {% elif app.final_decision == 'rejected' %}text-red-600
                      {% elif app.status == 'review' %}text-yellow-600
                      {% elif app.status == 'applied' %}text-blue-600
                      {% else %}text-gray-500
                      {% endif %}">
                      {% if app.final_decision %}
                        {{ app.final_decision|title }}
                      {% else %}
                        {{ app.status|title }}
                      {% endif %}
                    </p>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-gray-400 mt-5 text-center">No applicants yet.</p>
              {% endif %}
            </div>
          </div>

          <!-- Button to Kanban -->
          <a href="{% url 'applicant_kanban' %}"
             class="self-center mt-8 bg-[#42547c] text-white rounded-full px-8 py-2.5 border border-[#2b3853] hover:bg-[#2b3853] transition">
            Manage Applicants
          </a>
        </div>
      </div>

      <!-- === CARD 2: View Candidates === -->
      <div>
        <h2 class="text-2xl font-semibold text-[#243251] mb-6">View Candidates</h2>

        <div class="border border-black/30 rounded-[35px] p-6 min-h-[300px] flex flex-col justify-between shadow-sm bg-white">
          <p class="text-xl font-medium text-[#243251]">Candidate Directory</p>

          <p class="text-sm text-gray-500 mt-2">
            Browse the global talent pool of public job seekers.
          </p>

          <a href="{% url 'candidate_list' %}"
             class="self-center mt-8 bg-[#42547c] text-white rounded-full px-8 py-2.5 border border-[#2b3853] hover:bg-[#2b3853] transition">
            View Candidates
          </a>
        </div>
      </div>

      <!-- === CARD 3: Saved Candidate Searches === -->
      <div>
        <h2 class="text-2xl font-semibold text-[#243251] mb-6">Saved Candidate Searches</h2>

        <div class="border border-black/30 rounded-[35px] p-6 min-h-[260px] flex flex-col justify-between shadow-sm bg-white">
          {% if saved_searches %}
            <div class="max-h-48 overflow-y-auto pr-1">
              <ul class="space-y-3">
                {% for search in saved_searches %}
                  <li class="flex items-center justify-between">
                    <a href="{% url 'candidate_saved_search_run' search.id %}"
                       class="text-sm text-[#42547c] hover:underline">
                      {{ search.name }}
                    </a>
                    {% if search.last_run_at %}
                      <span class="text-[11px] text-gray-400">
                        Last run: {{ search.last_run_at|date:"M j, g:i a" }}
                      </span>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% else %}
            <p class="text-gray-400 text-sm">
              No saved searches yet. Go to the Candidate Directory and click “Save Search”.
            </p>
          {% endif %}

          <a href="{% url 'candidate_list' %}"
             class="self-center mt-6 bg-[#42547c] text-white rounded-full px-6 py-2 text-sm border border-[#2b3853] hover:bg-[#2b3853] transition">
            Open Candidate Directory
          </a>
        </div>
      </div>

    </div>

    <!-- ================= RIGHT: Job Listings ================= -->
    <div>
      <!-- Section Heading + Map Link -->
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-semibold text-[#243251]">My Job Listings</h2>
        <a href="{% url 'jobs:recruiter_map' %}"
           class="text-sm text-[#42547c] underline hover:text-[#2b3853]">
          View on Map
        </a>
      </div>

      <!-- Job Cards -->
      <div class="flex flex-col gap-6 items-center max-h-80 overflow-y-auto pr-1">
        {% for job in jobs %}
          <div class="w-[90%] p-6 rounded-[30px] border border-black/20 shadow-sm bg-white">
            <p class="text-xl font-medium mb-1">{{ job.title }}</p>
            <p class="text-sm text-gray-600 mb-2">{{ job.location }}</p>
            <a href="{% url 'jobs:job_detail' job.id %}"
               class="inline-block bg-[#42547c] text-white rounded-full px-5 py-1 text-sm hover:bg-[#2b3853] transition">
              View Details
            </a>
          </div>
        {% empty %}
          <p class="text-gray-400 text-center">No job listings yet.</p>
        {% endfor %}ss
      </div>

      <!-- Manage Listings -->
      <div class="text-center mt-12">
        <p class="text-[#243251] font-light mb-3">The perfect fit is out there!</p>
        <a href="{% url 'jobs:my_list' %}"
           class="inline-block bg-[#efce63] text-[#243251] rounded-full px-8 py-3 font-semibold text-lg hover:bg-[#d4b94a] transition">
          Manage Listings
        </a>
      </div>

      <!-- ================= Recommended Candidates (Right Column) ================= -->
      <div class="mt-12">
        <h2 class="text-2xl font-semibold text-[#243251] mb-6">Recommended Candidates</h2>

        <div class="border border-black/30 rounded-[35px] p-6 min-h-[260px] flex flex-col justify-between shadow-sm bg-white">
          {% if recommended_candidates %}
          <div class="max-h-56 overflow-y-auto pr-1">
            <ul class="space-y-0">
              {% for candidate in recommended_candidates %}
                <li class="border-t border-gray-400 pt-4 first:border-t-0 first:pt-0">
                  <a href="{% url 'candidate_profile' candidate.user.id %}"
                     class="block">
                    <!-- Top row: name + match percentage -->
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-base font-semibold text-[#243251]">
                          {{ candidate.user.username|capfirst }}
                        </p>
                        {% if candidate.user.jobseeker.headline %}
                          <p class="text-sm text-gray-500">
                            {{ candidate.user.jobseeker.headline }}
                          </p>
                        {% endif %}
                      </div>

                      {% if candidate.match_percentage %}
                        <span class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-[#efce63] text-[#243251] text-xs font-semibold">
                          {{ candidate.match_percentage }}% match
                        </span>
                      {% endif %}
                    </div>

                    <!-- Optional: quick education/degree line if present -->
                    {% if candidate.education %}
                      <p class="text-xs text-gray-500 mt-1 truncate">
                        {{ candidate.education }}
                      </p>
                    {% endif %}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
          {% else %}
            <p class="text-sm text-gray-500">
              You don't have any recommended candidates yet. Once you set your preferences and candidates match them,
              they'll appear here.
            </p>
          {% endif %}
        </div>
      </div>
    </div>

  </div> <!-- End Grid -->
</div>

{% endblock %}
